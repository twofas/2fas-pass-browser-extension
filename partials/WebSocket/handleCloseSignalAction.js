// SPDX-License-Identifier: BUSL-1.1
//
// Copyright Â© 2025 Two Factor Authentication Service, Inc.
// Licensed under the Business Source License 1.1
// See LICENSE file for full terms

import addNewSessionIdToDevice from './utils/addNewSessionIdToDevice';
import TwoFasWebSocket from '@/partials/WebSocket';

/** 
* Handles the close signal action.
* @param {string} newSessionId - The new session ID.
* @param {string} uuid - The unique identifier for the user.
* @param {Object} closeData - The data related to the close action.
* @param {Function} navigate - The navigation function.
* @return {Promise<void>}
*/
const handleCloseSignalAction = async (newSessionId, uuid, login) => {
  await addNewSessionIdToDevice(uuid, newSessionId); // FUTURE - Change to deviceId instead of uuid?

  try {
    const socket = TwoFasWebSocket.getInstance();
    socket.close();
  } catch {}

  await login();

  return true;
};

export default handleCloseSignalAction;
